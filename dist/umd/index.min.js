!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).bundle=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(o,!0).forEach((function(n){e(t,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(o).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}const o="@@redux-api-middleware/RSAA";function i(t){return t&&"object"==typeof t&&Object.getPrototypeOf(t)===Object.prototype}function a(t){return i(t)&&t.hasOwnProperty(o)}function s(t){const e=["type","payload","meta"];if(!i(t))return!1;for(let n in t)if(!~e.indexOf(n))return!1;return"type"in t&&("string"==typeof t.type||"symbol"==typeof t.type)}function p(t){var e=[];const n=["endpoint","options","method","body","headers","credentials","bailout","types","fetch","ok"],r=["omit","same-origin","include"];if(!a(t))return e.push("RSAAs must be plain JavaScript objects with an [RSAA] property"),e;const p=t[o];i(p)||e.push("[RSAA] property must be a plain JavaScript object");for(let t in p)~n.indexOf(t)||e.push(`Invalid [RSAA] key: ${t}`);const{endpoint:u,method:c,headers:f,options:y,credentials:l,types:d,bailout:h,fetch:b,ok:m}=p;if(void 0===u?e.push("[RSAA] must have an endpoint property"):"string"!=typeof u&&"function"!=typeof u&&e.push("[RSAA].endpoint property must be a string or a function"),void 0===c?e.push("[RSAA] must have a method property"):"string"!=typeof c?e.push("[RSAA].method property must be a string"):~["GET","HEAD","POST","PUT","PATCH","DELETE","OPTIONS"].indexOf(c.toUpperCase())||e.push(`Invalid [RSAA].method: ${c.toUpperCase()}`),void 0===f||i(f)||"function"==typeof f||e.push("[RSAA].headers property must be undefined, a plain JavaScript object, or a function"),void 0===y||i(y)||"function"==typeof y||e.push("[RSAA].options property must be undefined, a plain JavaScript object, or a function"),void 0!==l&&("string"!=typeof l?e.push("[RSAA].credentials property must be undefined, or a string"):~r.indexOf(l)||e.push(`Invalid [RSAA].credentials: ${l}`)),void 0!==h&&"boolean"!=typeof h&&"function"!=typeof h&&e.push("[RSAA].bailout property must be undefined, a boolean, or a function"),void 0===d)e.push("[RSAA] must have a types property");else if(Array.isArray(d)&&3===d.length){const[t,n,r]=d;"string"==typeof t||"symbol"==typeof t||s(t)||e.push("Invalid request type"),"string"==typeof n||"symbol"==typeof n||s(n)||e.push("Invalid success type"),"string"==typeof r||"symbol"==typeof r||s(r)||e.push("Invalid failure type")}else e.push("[RSAA].types property must be an array of length 3");return void 0!==b&&"function"!=typeof b&&e.push("[RSAA].fetch property must be a function"),void 0!==m&&"function"!=typeof m&&e.push("[RSAA].ok property must be a function"),e}class u extends Error{constructor(t){super(),this.name="InvalidRSAA",this.message="Invalid RSAA",this.validationErrors=t}}class c extends Error{constructor(t){super(),this.name="InternalError",this.message=t}}class f extends Error{constructor(t){super(),this.name="RequestError",this.message=t}}class y extends Error{constructor(t,e,n){super(),this.name="ApiError",this.status=t,this.statusText=e,this.response=n,this.message=`${t} - ${e}`}}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){d(t,e,n[e])}))}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}async function h(t){const e=t.headers.get("Content-Type");return!~[204,205].indexOf(t.status)&&e&&~e.indexOf("json")?await t.json():await Promise.resolve()}async function b(t,e=[]){try{t.payload="function"==typeof t.payload?await t.payload(...e):t.payload}catch(e){t.payload=new c(e.message),t.error=!0}try{t.meta="function"==typeof t.meta?await t.meta(...e):t.meta}catch(e){delete t.meta,t.payload=new c(e.message),t.error=!0}return t}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){A(t,e,n[e])}))}return t}function A(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const g={ok:t=>t.ok,fetch:fetch};function S(t={}){const e=Object.assign({},g,t);return({getState:t})=>n=>r=>a(r)?(async()=>{const i=p(r);if(i.length){const t=r[o];if(t.types&&Array.isArray(t.types)){let e=t.types[0];e&&e.type&&(e=e.type),n({type:e,payload:new u(i),error:!0})}return}const a=r[o];var{endpoint:s,body:d,headers:A,options:g={},fetch:S=e.fetch,ok:O=e.ok}=a;const{method:v,credentials:w,bailout:R,types:j}=a,[P,E,x]=function(t){let[e,n,r]=t;return"string"!=typeof e&&"symbol"!=typeof e||(e={type:e}),"string"!=typeof n&&"symbol"!=typeof n||(n={type:n}),"string"!=typeof r&&"symbol"!=typeof r||(r={type:r}),[e,n=l({payload:(t,e,n)=>h(n)},n),r=l({payload:(t,e,n)=>h(n).then(t=>new y(n.status,n.statusText,t))},r)]}(j);try{if("boolean"==typeof R&&R||"function"==typeof R&&R(t()))return}catch(e){return n(await b(m({},x,{payload:new f("[RSAA].bailout function failed"),error:!0}),[r,t()]))}if("function"==typeof s)try{s=s(t())}catch(e){return n(await b(m({},x,{payload:new f("[RSAA].endpoint function failed"),error:!0}),[r,t()]))}if("function"==typeof d)try{d=d(t())}catch(e){return n(await b(m({},x,{payload:new f("[RSAA].body function failed"),error:!0}),[r,t()]))}if("function"==typeof A)try{A=A(t())}catch(e){return n(await b(m({},x,{payload:new f("[RSAA].headers function failed"),error:!0}),[r,t()]))}if("function"==typeof g)try{g=g(t())}catch(e){return n(await b(m({},x,{payload:new f("[RSAA].options function failed"),error:!0}),[r,t()]))}let k,T;"function"==typeof P.payload||"function"==typeof P.meta?n(await b(P,[r,t()])):n(P);try{k=await S(s,m({},g,{method:v,body:d||void 0,credentials:w,headers:A||{}}))}catch(e){return n(await b(m({},x,{payload:new f(e.message),error:!0}),[r,t()]))}try{T=O(k)}catch(e){return n(await b(m({},x,{payload:new c("[RSAA].ok function failed"),error:!0}),[r,t(),k]))}return n(T?await b(E,[r,t(),k]):await b(m({},x,{error:!0}),[r,t(),k]))})():n(r)}var O=Object.freeze({__proto__:null,RSAA:o,isRSAA:a,validateRSAA:p,isValidRSAA:function(t){return!p(t).length},InvalidRSAA:u,InternalError:c,RequestError:f,ApiError:y,getJSON:h,createMiddleware:S,apiMiddleware:function({getState:t}){return S()({getState:t})}}).RSAA;return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{endpoint:"/",types:[],method:"GET",body:{},headers:{}},o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return t},s=n.types,p=[s[0],{type:s[1],payload:function(t,e,n){return i(t,e,n),n.json().then((function(t){return a(t)}))}},{type:s[2],meta:function(t,e,n){return i(t,e,n),n?{status:n.status,statusText:n.statusText}:{status:"Network request failed"}}}],u=o?n.body:JSON.stringify(n.body);return e({},O,{endpoint:n.endpoint||"",method:n.method||"GET",types:n.types?p:[],headers:r({},"object"===t(n.headers)?n.headers:{}),body:u})}}));
